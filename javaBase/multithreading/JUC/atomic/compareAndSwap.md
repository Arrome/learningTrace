# 无锁非阻塞算法（乐观锁） CAS(compare and swap)

**CPU指令级操作，只有一步原子操作**<br>

**原理**：当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其他线程都失败，失败的线程不会被挂起，而是被告知这次竞争中失败，可以再次尝试。（三个操作数，内存值、旧的预期值、要修改的新值，当且仅当预期值和内存值相同时，内存值修改为新值）

**存在问题**：算法实现前提需要取出内存中某时刻数据，而在下时刻比较并替换，在这个**时间差类会导致数据变化**<br>
**问题描述**：一个线程 one 从内存位置 V 中取出 A,这时候另一个线程 two 也从内存中取出 A,并且 two 进行了一些操作变成了 B,然后two又将 V 位置的数据变成 A,这时候线程 one 进行 CAS 操作发现内存中仍然是 A,然后 one操作成功。尽管线程 one 的 CAS 操作成功,是不代表这个过程就是没有问题的。如果链表的头在变化了两次后恢复了原值,但是不代表链表就没有变化。原子操作AtomicStampedReference/AtomicMarkableReference 此时就很有用。这允许一对变化的元素进行原子操作。
